<!--
Prompt: Create an html file with css and javascript. Loading this file locally in the browser should show a UI for a habit tracker app. There should be eight tasks (habits) in the habit tracker against each day. It should show current month, 10 days of the last month and 10 days of the next month. 

These are the 8 habits that I am working on: PNS, Dinner Time, Bed time, Sleep hours, Read, Write, Max HR, Steps.

Each cell of the habit tracker corresponds to the status of that particular habit on that day. For PNS, Read, Write, it should be a check box. For Dinner Time, Bed Time, Sleep Hours, and Max HR, it should be input text box.

Any changes on this page should be preserved locally in a file so that loading this file again should maintain the state of the habit tracker. 

No, I want you to write the data on a file on the disc, so that the app should work even if the html file is opened across different browsers. Don't use browser localstorage. Use file system for maintaing the state of the app.

I want you to store in local storage and also give an ability to save as json by adding a save data button. On closing the window, it should give an alert that data hasn't been saved. There should also be a small status button (an icon) somewhere on the page (visible prominently) which indicates that there's unsaved data.

Swap the rows and columns. Show the date on the rows, and the habits on the column. Also, show the dates in this format - DD/MM.

Add a small button at top which should scroll the screen to the date which is today's date. The scroll should be such that the "scrolled to" poistion is at the center of the screen (veritcally)

The scroll to today is overlapping on top of the page header/title. Make the button very small, like an icon. And show it on the top right corner.

Show me the complete code, Dude.

When the page loads for the first time, it should by default scroll down to the row which is today's date. Also, the save data button should be a floating button at the bottom right corner of the screen. Make the button little more conspicuous.

Saving the file should save it as .json file and there should also be an import button at the top (next to the calendar button which is used for scrolling to current date). Import button should take the json file (which was earlier exported from save button), and overwrite the data in localstorage (only for overlapping dates, and preserve the localstoraeg data which is not there in the json file).

Edit

-->
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Habit Tracker</title>
    <style>
      body {
        font-family: Arial, sans-serif;
        margin: 0;
        padding: 20px;
        padding-bottom: 80px;
      }
      table {
        border-collapse: collapse;
        width: 100%;
      }
      th,
      td {
        border: 1px solid #ddd;
        padding: 8px;
        text-align: center;
      }
      th {
        background-color: #f2f2f2;
        position: sticky;
        top: 0;
        z-index: 10;
      }
      input[type="text"] {
        width: 50px;
      }
      .current-month {
        background-color: #e6f3ff;
      }
      #save-button {
        position: fixed;
        bottom: 20px;
        right: 20px;
        padding: 15px 25px;
        font-size: 18px;
        background-color: #4caf50;
        color: white;
        border: none;
        border-radius: 50px;
        cursor: pointer;
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
        transition: background-color 0.3s, transform 0.1s;
      }
      #save-button:hover {
        background-color: #45a049;
      }
      #save-button:active {
        transform: scale(0.98);
      }
      #unsaved-icon {
        position: fixed;
        top: 10px;
        right: 70px;
        width: 20px;
        height: 20px;
        background-color: red;
        border-radius: 50%;
        display: none;
      }
      #scroll-to-today,
      #import-button {
        position: fixed;
        top: 10px;
        z-index: 100;
        width: 24px;
        height: 24px;
        background-color: #f0f0f0;
        border: none;
        border-radius: 50%;
        cursor: pointer;
        display: flex;
        justify-content: center;
        align-items: center;
        font-size: 14px;
        color: #333;
        box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2);
      }
      #scroll-to-today {
        right: 10px;
      }
      #import-button {
        right: 40px;
      }
      #scroll-to-today:hover,
      #import-button:hover {
        background-color: #e0e0e0;
      }
      .today {
        background-color: #ffff99;
      }
      #file-input {
        display: none;
      }
      .radio-group {
        display: flex;
        justify-content: center;
        gap: 5px;
      }
      .radio-group label {
        display: flex;
        align-items: center;
      }
    </style>
  </head>
  <body>
    <h1>Habit Tracker</h1>
    <div id="unsaved-icon" title="Unsaved changes"></div>
    <button id="scroll-to-today" title="Scroll to Today">ðŸ“…</button>
    <button id="import-button" title="Import Data">ðŸ“¥</button>
    <input type="file" id="file-input" accept=".json" />
    <div id="habit-tracker"></div>
    <button id="save-button">Save Data</button>

    <script>
      const habits = [
        { name: "PNS", type: "radio" },
        { name: "Dinner Time", type: "text" },
        { name: "Bed Time", type: "text" },
        { name: "Sleep Hours", type: "text" },
        { name: "Read", type: "radio" },
        { name: "Write", type: "radio" },
        { name: "Max HR", type: "text" },
        { name: "Steps", type: "text" },
      ];

      let hasUnsavedChanges = false;

      function getDaysArray(year, month) {
        const date = new Date(year, month, 1);
        const result = [];
        while (date.getMonth() === month) {
          result.push(new Date(date));
          date.setDate(date.getDate() + 1);
        }
        return result;
      }

      function formatDate(date) {
        return `${date.getDate().toString().padStart(2, "0")}/${(
          date.getMonth() + 1
        )
          .toString()
          .padStart(2, "0")}`;
      }

      function createHabitTracker() {
        const now = new Date();
        const currentYear = now.getFullYear();
        const currentMonth = now.getMonth();
        const today = now.getDate();

        const prevMonthDays = getDaysArray(currentYear, currentMonth - 1).slice(
          -10
        );
        const currentMonthDays = getDaysArray(currentYear, currentMonth);
        const nextMonthDays = getDaysArray(currentYear, currentMonth + 1).slice(
          0,
          10
        );

        const allDays = [
          ...prevMonthDays,
          ...currentMonthDays,
          ...nextMonthDays,
        ];

        let html = "<table><tr><th>Date</th>";
        habits.forEach((habit) => {
          html += `<th>${habit.name}</th>`;
        });
        html += "</tr>";

        allDays.forEach((day) => {
          const isCurrentMonth = day.getMonth() === currentMonth;
          const isToday = isCurrentMonth && day.getDate() === today;
          const className = isCurrentMonth ? "current-month" : "";
          const todayClass = isToday ? "today" : "";
          html += `<tr class="${className} ${todayClass}" data-date="${formatDate(
            day
          )}"><td>${formatDate(day)}</td>`;
          habits.forEach((habit) => {
            const id = `${habit.name.replace(" ", "-")}-${
              day.toISOString().split("T")[0]
            }`;
            if (habit.type === "radio") {
              html += `<td>
                            <div class="radio-group">
                                <label><input type="radio" name="${id}" value="Yes" id="${id}-yes"> Yes</label>
                                <label><input type="radio" name="${id}" value="No" id="${id}-no"> No</label>
                            </div>
                        </td>`;
            } else {
              html += `<td><input type="text" id="${id}"></td>`;
            }
          });
          html += "</tr>";
        });

        html += "</table>";
        document.getElementById("habit-tracker").innerHTML = html;

        // Add event listeners to inputs
        const inputs = document.querySelectorAll("input");
        inputs.forEach((input) => {
          input.addEventListener("change", handleInputChange);
          // Load saved data
          const savedValue = localStorage.getItem(input.id);
          if (savedValue !== null) {
            if (input.type === "radio") {
              input.checked = input.value === savedValue;
            } else {
              input.value = savedValue;
            }
          }
        });

        // Scroll to today's date
        setTimeout(scrollToToday, 100);
      }

      function handleInputChange(event) {
        const input = event.target;
        let value;
        if (input.type === "radio") {
          value = input.value;
          localStorage.setItem(input.name, value);
        } else {
          value = input.value;
          localStorage.setItem(input.id, value);
        }
        setUnsavedChanges(true);
      }

      function setUnsavedChanges(value) {
        hasUnsavedChanges = value;
        document.getElementById("unsaved-icon").style.display = value
          ? "block"
          : "none";
      }

      function saveData() {
        const data = {};
        const inputs = document.querySelectorAll("input");
        inputs.forEach((input) => {
          if (input.type === "radio" && input.checked) {
            data[input.name] = input.value;
          } else if (input.type === "text") {
            data[input.id] = input.value;
          }
        });

        const dataStr = JSON.stringify(data, null, 2);
        const blob = new Blob([dataStr], { type: "application/json" });
        const url = URL.createObjectURL(blob);

        const exportFileDefaultName = "habit_tracker_data.json";

        const linkElement = document.createElement("a");
        linkElement.setAttribute("href", url);
        linkElement.setAttribute("download", exportFileDefaultName);
        linkElement.click();

        URL.revokeObjectURL(url);

        setUnsavedChanges(false);
      }

      function importData(event) {
        const file = event.target.files[0];
        if (file) {
          const reader = new FileReader();
          reader.onload = function (e) {
            try {
              const importedData = JSON.parse(e.target.result);
              for (let key in importedData) {
                localStorage.setItem(key, importedData[key]);
              }
              createHabitTracker(); // Refresh the tracker with imported data
              alert("Data imported successfully!");
            } catch (error) {
              alert(
                "Error importing data. Please make sure the file is a valid JSON."
              );
            }
          };
          reader.readAsText(file);
        }
      }

      function scrollToToday() {
        const today = new Date();
        const formattedDate = formatDate(today);
        const todayRow = document.querySelector(
          `tr[data-date="${formattedDate}"]`
        );

        if (todayRow) {
          const rect = todayRow.getBoundingClientRect();
          const scrollTop =
            window.pageYOffset || document.documentElement.scrollTop;
          const targetScrollPosition =
            scrollTop + rect.top - window.innerHeight / 2 + rect.height / 2;

          window.scrollTo({
            top: targetScrollPosition,
            behavior: "smooth",
          });
        }
      }

      createHabitTracker();

      document
        .getElementById("save-button")
        .addEventListener("click", saveData);
      document
        .getElementById("scroll-to-today")
        .addEventListener("click", scrollToToday);
      document
        .getElementById("import-button")
        .addEventListener("click", () =>
          document.getElementById("file-input").click()
        );
      document
        .getElementById("file-input")
        .addEventListener("change", importData);

      window.addEventListener("beforeunload", (event) => {
        if (hasUnsavedChanges) {
          event.preventDefault();
          event.returnValue = "";
        }
      });
    </script>
  </body>
</html>
